Ext.define("Cell.button.Button",{extend:"Ext.button.Button",alias:"widget.cell.button",baseCls:Cell.prefix+"-button"});Ext.define("Cell.button.Cycle",{extend:"Ext.button.Cycle",alias:"widget.cell.button.cycle",baseCls:Cell.prefix+"-button-cycle"});Ext.define("Cell.panel.DarkPanel",{extend:"Ext.panel.Panel",alias:Cell.prefix+".panel.darkPanel",baseCls:Cell.prefix+"-panel",ui:"dark",bodyCls:"panel-body",maxWidth:600});(function(){Ext.define("Cell.IndexItems",{extend:"Ext.data.Model",fields:["title","icn","id"]});Ext.define("Cell.VerticalTabPanel",{extend:"Ext.panel.Panel",alias:"widget.verticaltab",cls:"cell-vtabpanel",mainPanel:null,indexData:null,settingPageList:[],defaultPage:0,nowPage:0,listeners:{activate:function(){MessageHub.send(new Message.MainPanel.ActivateSettingTab)},deactivate:function(){MessageHub.send(new Message.MainPanel.DeactivateSettingTab)}},initComponent:function(){var a=(new Spinner({lines:11,
length:11,width:5,radius:10,color:"#000",className:"spinner spinner-setting-load"})).spin();this.loadmask=new Ext.LoadMask(this,{msg:a.el.outerHTML+"Loading..."});this.indexes=this.makeIndex(this.indexData);this.settingPage=this.makeSettingPage(this.settingPageList);Ext.apply(this,{iconCls:"ide-loading-icon2",layout:"border",items:[this.indexes,this.settingPage],listeners:{afterRender:this.onAfterRender}});this.callParent()},onAfterRender:function(){Message.MainPanel.PopTabQueue.send()},makeSettingPage:function(a){return Ext.create("Ext.panel.Panel",
{region:"center",layout:{type:"fit"},bodyStyle:"border-style : none none none solid;",items:[{xtype:"panel",itemId:"setting_card_panel",border:!1,activeItem:this.defaultPage,layout:"card",items:a}]})},makeIndex:function(a){var b=this;return Ext.create("Ext.view.View",{region:"west",split:!1,bodyPadding:5,itemId:"setting_west_panel",cls:"cell-tabs",store:Ext.create("Ext.data.Store",{model:"Cell.IndexItems",data:a}),listeners:{scope:b,beforecontainerclick:function(){return!1},beforeitemclick:function(a,
d){b.onBeforeTabChange(b,d.data.id)},selectionchange:function(a,d){0!=d.length&&b.setActivePanel(d[0].data.id)},afterRender:function(a){a.getSelectionModel().select(b.defaultPage,!1,!0)}},trackOver:!0,itemSelector:".cell-tabs-item",overItemCls:"cell-tabs-item-hover",tpl:'<tpl for="."><div class="cell-tabs-item"><tpl if="icn"><img src="{icn}" /></tpl><i>{title}</i></div></tpl>'})},setActivePanel:function(a){var b=this,c=b.down("#setting_card_panel");setTimeout(function(){c.getLayout().setActiveItem(a);
b.nowPage=a;b.onTabChange(b,a)},20,b,a)},onBeforeTabChange:function(){},onTabChange:function(){},setActiveItem:function(a){this.down("#setting_west_panel").getSelectionModel().select(a,!1,!0)}});Ext.define("Cell.SettingPanel",{extend:"Ext.form.Panel",alias:"widget.settingpanel",cls:"cell-settings-panel",autoScroll:!0,defaultType:"textfield",fieldDefaults:{msgTarget:"side",labelWidth:180},parent:null,defaults:{xtype:"fieldset",ui:"line"},updateCaution:function(a,b){if(a.errorEl&&a.errorEl.dom){var c=
a.getValue();if("string"!==typeof c)for(var d in c)c=c[d];d=a.el.dom.classList;a.isValid()?(a.errorEl.dom.innerText="",c!==a.origValue?(d.remove("error"),d.add("caution"),setTimeout(function(){a.markInvalid(b)},0)):(d.remove("caution"),d.remove("error"))):(d.remove("caution"),d.add("error"))}}})})();Ext.define("Cell.window.DarkWindow",{extend:"Ext.window.Window",alias:Cell.prefix+".window.darkWindow",baseCls:Cell.prefix+"-dark-window",itemCls:"cell-dark-window-item",bodyCls:"window-body"});
Ext.define("Cell.window.DarkMessageBox",{extend:"Cell.window.DarkWindow",requires:"Ext.toolbar.Toolbar Ext.form.field.Text Ext.form.field.TextArea Ext.button.Button Ext.layout.container.Anchor Ext.layout.container.HBox Ext.ProgressBar".split(" "),alternateClassName:"Cell.DarkMessageBox",alias:Cell.prefix+".darkMessageBox",OK:1,YES:2,NO:4,CANCEL:8,OKCANCEL:9,YESNO:6,YESNOCANCEL:14,INFO:"ext-mb-info",WARNING:"ext-mb-warning",QUESTION:"ext-mb-question",ERROR:"ext-mb-error",hideMode:"offsets",closeAction:"hide",
resizable:!1,title:"&#160;",width:600,height:500,minWidth:250,maxWidth:600,minHeight:110,maxHeight:500,constrain:!0,layout:{type:"anchor"},defaultTextHeight:75,minProgressWidth:250,minPromptWidth:250,buttonText:{ok:"OK",yes:"Yes",no:"No",cancel:"Cancel"},buttonIds:["ok","yes","no","cancel"],titleText:{confirm:"Confirm",prompt:"Prompt",wait:"Loading...",alert:"Attention"},iconHeight:35,makeButton:function(a){a=this.buttonIds[a];return Ext.create("Cell.button.Button",{handler:this.btnCallback,itemId:a,
ui:"dark",scope:this,text:this.buttonText[a],minWidth:75})},btnCallback:function(a){var b,c;if(this.cfg.prompt||this.cfg.multiline)c=this.cfg.multiline?this.textArea:this.textField,b=c.getValue(),c.reset();a.blur();this.hide();this.userCallback(a.itemId,b,this.cfg)},hide:function(){this.dd.endDrag();this.progressBar.reset();this.removeCls(this.cfg.cls);this.callParent()},initComponent:function(){var a,b;this.title="&#160;";this.topContainer=Ext.create("Ext.container.Container",{anchor:"100%",style:{padding:"10px",
overflow:"hidden"},items:[this.iconComponent=Ext.create("Ext.Component",{cls:"ext-mb-icon",width:50,height:this.iconHeight,style:{"float":"left"}}),this.promptContainer=Ext.create("Ext.container.Container",{layout:{type:"anchor"},items:[this.msg=Ext.create("Ext.Component",{autoEl:{tag:"span"},cls:"ext-mb-text"}),this.textField=Ext.create("Ext.form.field.Text",{ui:"mini",style:"margin-top: 5px;",anchor:"100%",enableKeyEvents:!0,listeners:{keydown:this.onPromptKey,scope:this}}),this.textArea=Ext.create("Ext.form.field.TextArea",
{anchor:"100%",style:"margin-top: 5px;",height:75})]})]});this.progressBar=Ext.create("Ext.ProgressBar",{anchor:"-10",style:"margin-left:10px"});this.items=[this.topContainer,this.progressBar];this.msgButtons=[];for(a=0;4>a;a++)b=this.makeButton(a),this.msgButtons[b.itemId]=b,this.msgButtons.push(b);this.bottomTb=Ext.create("Ext.toolbar.Toolbar",{ui:"footer",dock:"bottom",layout:{pack:"center"},items:[this.msgButtons[0],this.msgButtons[1],this.msgButtons[2],this.msgButtons[3]]});this.dockedItems=
[this.bottomTb];this.callParent()},onPromptKey:function(a,b){var c;if(b.keyCode===Ext.EventObject.RETURN||10===b.keyCode)this.msgButtons.ok.isVisible()?(c=!0,this.msgButtons.ok.handler.call(this,this.msgButtons.ok)):this.msgButtons.yes.isVisible()&&(this.msgButtons.yes.handler.call(this,this.msgButtons.yes),c=!0),c&&this.textField.blur()},reconfigure:function(a){var b=a.buttons||0,c=!0,d=this.maxWidth;this.cfg=a=a||{};a.width&&(d=a.width);delete this.defaultFocus;this.animateTarget=a.animateTarget||
void 0;this.modal=!1!==a.modal;a.title&&this.setTitle(a.title||"&#160;");this.rendered?this.setSize(d,this.maxHeight):(this.width=d,this.render(Ext.getBody()));this.setPosition(-1E4,-1E4);this.closable=a.closable&&!a.wait;!1===a.closable?this.tools.close.hide():this.tools.close.show();!a.title&&!this.closable?this.header.hide():this.header.show();this.liveDrag=!a.proxyDrag;this.userCallback=Ext.Function.bind(a.callback||a.fn||Ext.emptyFn,a.scope||Ext.global);this.setIcon(a.icon);a.msg?(this.msg.update(Ext.util.Format.nl2br(Ext.util.Format.htmlEncode(a.msg))),
this.msg.show()):this.msg.hide();a.prompt||a.multiline?(this.multiline=a.multiline)?(this.textArea.setValue(a.value),this.textArea.setHeight(a.defaultTextHeight||this.defaultTextHeight),this.textArea.show(),this.textField.hide(),this.defaultFocus=this.textArea):(this.textField.setValue(a.value),this.textArea.hide(),this.textField.show(),this.defaultFocus=this.textField):(this.textArea.hide(),this.textField.hide());a.progress||a.wait?(this.progressBar.show(),this.updateProgress(0,a.progressText),!0===
a.wait&&this.progressBar.wait(a.waitConfig)):this.progressBar.hide();for(a=0;4>a;a++)b&Math.pow(2,a)?(this.defaultFocus||(this.defaultFocus=this.msgButtons[a]),this.msgButtons[a].show(),c=!1):this.msgButtons[a].hide();c?this.bottomTb.hide():this.bottomTb.show();this.hidden=!0},show:function(a){this.reconfigure(a);this.addCls(a.cls);a.animateTarget?(this.doAutoSize(!1),this.callParent()):(this.callParent(),this.doAutoSize(!0));return this},afterShow:function(){this.animateTarget&&this.center();this.callParent(arguments)},
doAutoSize:function(a){var b=this.iconComponent,c=this.iconHeight;Ext.isDefined(this.frameWidth)||(this.frameWidth=this.el.getWidth()-this.body.getWidth());b.setHeight(c);this.minWidth=this.cfg.minWidth||Ext.getClass(this).prototype.minWidth;this.topContainer.doLayout();if(Ext.isIE6||Ext.isIEQuirks)this.textField.setCalculatedSize(9),this.textArea.setCalculatedSize(9);var d=this.cfg.width||this.msg.getWidth()+b.getWidth()+25,e=(this.header.rendered?this.header.getHeight():0)+Math.max(this.promptContainer.getHeight(),
b.getHeight())+this.progressBar.getHeight()+(this.bottomTb.rendered?this.bottomTb.getHeight():0)+20;b.setHeight(Math.max(c,this.msg.getHeight()));this.setSize(d+this.frameWidth,e+this.frameWidth);a&&this.center();return this},updateText:function(a){this.msg.update(a);return this.doAutoSize(!0)},setIcon:function(a){this.iconComponent.removeCls(this.iconCls);a?(this.iconComponent.show(),this.iconComponent.addCls(Ext.baseCSSPrefix+"dlg-icon"),this.iconComponent.addCls(this.iconCls=a)):(this.iconComponent.removeCls(Ext.baseCSSPrefix+
"dlg-icon"),this.iconComponent.hide());return this},updateProgress:function(a,b,c){this.progressBar.updateProgress(a,b);c&&this.updateText(c);return this},onEsc:function(){!1!==this.closable&&this.callParent(arguments)},confirm:function(a,b,c,d){Ext.isString(a)&&(a={title:a,icon:"ext-mb-question",msg:b,buttons:this.YESNO,callback:c,scope:d});return this.show(a)},prompt:function(a,b,c,d,e,g){Ext.isString(a)&&(a={prompt:!0,title:a,minWidth:this.minPromptWidth,msg:b,buttons:this.OKCANCEL,callback:c,
scope:d,multiline:e,value:g});return this.show(a)},wait:function(a,b,c){Ext.isString(a)&&(a={title:b,msg:a,closable:!1,wait:!0,modal:!0,minWidth:this.minProgressWidth,waitConfig:c});return this.show(a)},alert:function(a,b,c,d){Ext.isString(a)&&(a={title:a,msg:b,buttons:this.OK,fn:c,scope:d,minWidth:this.minWidth});return this.show(a)},progress:function(a,b,c){Ext.isString(a)&&(a={title:a,msg:b,progressText:c});return this.show(a)}},function(){Cell.DarkMessageBox=Cell.DarkMsg=new this});Ext.define("Cell.window.LightWindow",{extend:"Ext.window.Window",alias:Cell.prefix+".window.lightWindow",baseCls:Cell.prefix+"-light-window",itemCls:"cell-light-window-item",bodyCls:"window-body"});
Ext.define("Cell.window.LightMessageBox",{extend:"Cell.window.LightWindow",requires:"Ext.toolbar.Toolbar Ext.form.field.Text Ext.form.field.TextArea Ext.button.Button Ext.layout.container.Anchor Ext.layout.container.HBox Ext.ProgressBar".split(" "),alternateClassName:"Cell.LightMessageBox",alias:Cell.prefix+".lightMessageBox",OK:1,YES:2,NO:4,CANCEL:8,OKCANCEL:9,YESNO:6,YESNOCANCEL:14,INFO:"ext-mb-info",WARNING:"ext-mb-warning",QUESTION:"ext-mb-question",ERROR:"ext-mb-error",hideMode:"offsets",closeAction:"hide",
resizable:!1,title:"&#160;",width:600,height:500,minWidth:480,maxWidth:700,minHeight:180,maxHeight:500,defaultTextHeight:75,minProgressWidth:320,minPromptWidth:320,iconHeight:35,constrain:!0,layout:{type:"anchor"},buttonText:Forte.Resources.Text.MESSAGEBOX_BUTTON_TEXT,buttonIds:["ok","yes","no","cancel"],titleText:{confirm:"Confirm",prompt:"Prompt",wait:"Loading...",alert:"Attention"},makeButton:function(a,b){var c=this.buttonIds[a];return Ext.create("Cell.button.Button",{ui:b,handler:this.btnCallback,
itemId:c,scope:this,text:this.buttonText[c],minWidth:75})},btnCallback:function(a){var b,c;if(this.cfg.prompt||this.cfg.multiline)c=this.cfg.multiline?this.textArea:this.textField,b=c.getValue(),c.reset();a.blur();this.hide();this.userCallback(a.itemId,b,this.cfg)},hide:function(){this.dd.endDrag();this.progressBar.reset();this.removeCls(this.cfg.cls);this.callParent()},initComponent:function(){var a,b;this.title="&#160;";this.topContainer=Ext.create("Ext.container.Container",{anchor:"100%",style:{padding:"10px",
overflow:"hidden"},items:[this.iconComponent=Ext.create("Ext.Component",{cls:"ext-mb-icon",width:50,height:this.iconHeight,style:{"float":"left"}}),this.promptContainer=Ext.create("Ext.container.Container",{layout:{type:"anchor"},items:[this.msg=Ext.create("Ext.Component",{autoEl:{tag:"span"},cls:"ext-mb-text"}),this.textField=Ext.create("Ext.form.field.Text",{anchor:"100%",enableKeyEvents:!0,listeners:{keydown:this.onPromptKey,scope:this}}),this.textArea=Ext.create("Ext.form.field.TextArea",{anchor:"100%",
height:75})]})]});this.progressBar=Ext.create("Ext.ProgressBar",{anchor:"-10",style:"margin-left:10px"});this.items=[this.topContainer,this.progressBar];this.msgButtons=[];for(a=0;4>a;a++)b=this.makeButton(a,"light"),this.msgButtons[b.itemId]=b,this.msgButtons.push(b);this.bottomTb=Ext.create("Ext.toolbar.Toolbar",{ui:"footer",dock:"bottom",layout:{pack:"center"},items:[this.msgButtons[0],this.msgButtons[1],this.msgButtons[2],this.msgButtons[3]]});this.dockedItems=[this.bottomTb];this.callParent()},
onPromptKey:function(a,b){var c;if(b.keyCode===Ext.EventObject.RETURN||10===b.keyCode)this.msgButtons.ok.isVisible()?(c=!0,this.msgButtons.ok.handler.call(this,this.msgButtons.ok)):this.msgButtons.yes.isVisible()&&(this.msgButtons.yes.handler.call(this,this.msgButtons.yes),c=!0),c&&this.textField.blur()},reconfigure:function(a){var b=a.buttons||0,c=!0,d=this.maxWidth;this.cfg=a=a||{};a.width&&(d=a.width);delete this.defaultFocus;this.animateTarget=a.animateTarget||void 0;this.modal=!1!==a.modal;a.title&&
this.setTitle(a.title||"&#160;");this.rendered?this.setSize(d,this.maxHeight):(this.width=d,this.render(Ext.getBody()));this.setPosition(-1E4,-1E4);this.closable=a.closable&&!a.wait;!1===a.closable?this.tools.close.hide():this.tools.close.show();!a.title&&!this.closable?this.header.hide():this.header.show();this.liveDrag=!a.proxyDrag;this.userCallback=Ext.Function.bind(a.callback||a.fn||Ext.emptyFn,a.scope||Ext.global);this.setIcon(a.icon);a.msg?(a.noEscape?this.msg.update(a.msg):this.msg.update(Ext.util.Format.nl2br(Ext.util.Format.htmlEncode(a.msg))),
this.msg.show()):this.msg.hide();a.prompt||a.multiline?(this.multiline=a.multiline)?(this.textArea.setValue(a.value),this.textArea.setHeight(a.defaultTextHeight||this.defaultTextHeight),this.textArea.show(),this.textField.hide(),this.defaultFocus=this.textArea):(this.textField.setValue(a.value),this.textArea.hide(),this.textField.show(),this.defaultFocus=this.textField):(this.textArea.hide(),this.textField.hide());a.progress||a.wait?(this.progressBar.show(),this.updateProgress(0,a.progressText),!0===
a.wait&&this.progressBar.wait(a.waitConfig)):this.progressBar.hide();for(d=0;4>d;d++)b&Math.pow(2,d)?(c="light",a.buttonUi&&0<a.buttonUi.length&&(c=a.buttonUi[0],a.buttonUi.splice(0,1)),this.msgButtons[d].setUI(c),this.defaultFocus||(this.defaultFocus=this.msgButtons[d]),this.msgButtons[d].show(),c=!1):this.msgButtons[d].hide();c?this.bottomTb.hide():this.bottomTb.show();this.hidden=!0},show:function(a){this.reconfigure(a);this.addCls(a.cls);a.animateTarget?(this.doAutoSize(!1),this.callParent()):
(this.callParent(),this.doAutoSize(!0));return this},afterShow:function(){this.animateTarget&&this.center();this.callParent(arguments)},doAutoSize:function(a){var b=this.iconComponent,c=this.iconHeight;Ext.isDefined(this.frameWidth)||(this.frameWidth=this.el.getWidth()-this.body.getWidth());b.setHeight(c);this.minWidth=this.cfg.minWidth||Ext.getClass(this).prototype.minWidth;this.topContainer.doLayout();this.header.getHeight();this.promptContainer.getHeight();var d=this.cfg.width||this.msg.getWidth()+
b.getWidth()+25;b.setHeight(Math.max(c,this.msg.getHeight()));this.setWidth(d+this.frameWidth);b=(this.header.rendered?this.header.getHeight():45)+Math.max(this.promptContainer.getHeight(),b.getHeight())+this.progressBar.getHeight()+(this.bottomTb.rendered?this.bottomTb.getHeight():0)+20;this.setHeight(b+this.frameWidth);a&&this.center();return this},updateText:function(a){this.msg.update(a);return this.doAutoSize(!0)},setIcon:function(a){this.iconComponent.removeCls(this.iconCls);a?(this.iconComponent.show(),
this.iconComponent.addCls(Ext.baseCSSPrefix+"dlg-icon"),this.iconComponent.addCls(this.iconCls=a)):(this.iconComponent.removeCls(Ext.baseCSSPrefix+"dlg-icon"),this.iconComponent.hide());return this},updateProgress:function(a,b,c){this.progressBar.updateProgress(a,b);c&&this.updateText(c);return this},onEsc:function(){!1!==this.closable&&this.callParent(arguments)},confirm:function(a,b,c,d){Ext.isString(a)&&(a={title:a,icon:"ext-mb-question",msg:b,buttons:this.YESNO,callback:c,scope:d});return this.show(a)},
prompt:function(a,b,c,d,e,g){Ext.isString(a)&&(a={prompt:!0,title:a,minWidth:this.minPromptWidth,msg:b,buttons:this.OKCANCEL,callback:c,scope:d,multiline:e,value:g});return this.show(a)},wait:function(a,b,c){Ext.isString(a)&&(a={title:b,msg:a,closable:!1,wait:!0,modal:!0,minWidth:this.minProgressWidth,waitConfig:c});return this.show(a)},alert:function(a,b,c,d){Ext.isString(a)&&(a={title:a,msg:b,buttons:this.OK,fn:c,scope:d,minWidth:this.minWidth});return this.show(a)},progress:function(a,b,c){Ext.isString(a)&&
(a={title:a,msg:b,progressText:c});return this.show(a)}},function(){Cell.LightMessageBox=Cell.LightMsg=new this});
Ext.define("Cell.window.CollectionSecurityWindow",{extend:"Cell.window.LightWindow",title:Forte.Resources.Text.CLOUD_COLLECTION_SECURITY_TITLE,closable:!0,resizable:!1,layout:"vbox",modal:!0,width:370,height:284,colName:null,colConfig:null,bbar:["->",{xtype:"cell.button",ui:"light",width:100,text:Forte.Resources.Text.GENERAL_CANCEL,handler:function(){this.ownerCt.ownerCt.close()}},{xtype:"cell.button",ui:"blue",width:100,text:Forte.Resources.Text.GENERAL_SAVE,handler:function(){var a=this.ownerCt.ownerCt,
b=a.down("#isinsertable").getValue(),c="";a.down("#newuserread").getValue()&&(c+="r");a.down("#newuserwrite").getValue()&&(c+="w");Forte.API.postCloud("Collection.setConfig",{_id:a.colName,isInsertable:b,defaultPublicPermission:c},function(){a.colConfig.defaultPublicPermission=c;a.colConfig.isInsertable=b;Cell.LightMessageBox.alert("Success",Forte.Resources.Text.CLOUD_COLLECTION_UPDATED)});a.close()}}],listeners:{afterrender:function(){this.setTitle(this.title+" ("+this.colName+")");this.getComponent("isinsertable").setValue(this.colConfig.isInsertable);
0<=this.colConfig.defaultPublicPermission.indexOf("r")&&this.down("#newuserread").setValue(!0);0<=this.colConfig.defaultPublicPermission.indexOf("w")&&this.down("#newuserwrite").setValue(!0)}},initComponent:function(){Ext.apply(this,{items:[{xtype:"checkbox",itemId:"isinsertable",boxLabel:Forte.Resources.Text.CLOUD_COLLECTION_ALLOW_INSERT,editable:!0,style:"margin: 25px 0 25px 20px;"},{xtype:"component",html:Forte.Resources.Text.CLOUD_COLLECTION_DEFAULT_PERMISSION,style:"margin:0 0 10px;"},{xtype:"container",
layout:"hbox",width:496,height:34,style:"margin-left: 20px;",items:[{xtype:"component",html:Forte.Resources.Text.CLOUD_COLLECTION_ITEM_OWNER,width:60},{xtype:"checkbox",boxLabel:"Read",checked:!0,disabled:!0,editable:!1,style:"margin-right: 20px"},{xtype:"checkbox",boxLabel:"Write",checked:!0,disabled:!0,editable:!1}]},{xtype:"container",layout:"hbox",width:496,style:"margin-left: 20px;",items:[{xtype:"component",html:"Public: ",width:60},{xtype:"checkbox",itemId:"newuserread",boxLabel:"read",editable:!0,
style:"margin-right: 20px"},{xtype:"checkbox",itemId:"newuserwrite",boxLabel:"write",editable:!0}]}]});this.callParent()}});Ext.define("Cell.tab.TabPanel",{extend:"Ext.tab.Panel",alias:Cell.prefix+".tabPanel",baseCls:Cell.prefix+"-tab-panel",itemCls:"cell-tab-panel-item",bodyCls:"panel-body",updateEmptyPanel:function(){var a=0==this.items.length?"hidden":"visible";0==this.items.length?(this.getEl().addCls("cell-tab-panel-empty").select(".cell-tab-panel").addCls("cell-tab-panel-empty"),this.getEl().select(".cell-tab-panel-body").addCls("cell-tab-panel-body-empty")):(this.getEl().removeCls("cell-tab-panel-empty").select(".cell-tab-panel").removeCls("cell-tab-panel-empty"),
this.getEl().select(".cell-tab-panel-body").removeCls("cell-tab-panel-body-empty"));this.getEl().select(".x-tab-bar").setStyle({visibility:a})},listeners:{afterlayout:function(){this.updateEmptyPanel()},remove:function(){0==this.tabBar.items.getCount()&&Ext.get("mainpanel-closeall")&&Ext.get("mainpanel-closeall").hide()},add:function(){Ext.get("mainpanel-closeall")&&Ext.get("mainpanel-closeall").show()}},onAdd:function(a,b){var c=a.tabConfig||{},d={xtype:"tab",card:a,disabled:a.disabled,closable:a.closable,
hidden:a.hidden,tabBar:this.tabBar};a.closeText&&(d.closeText=a.closeText);c=Ext.applyIf(c,d);a.tab=this.tabBar.insert(b,c);a.on({scope:this,enable:this.onItemEnable,disable:this.onItemDisable,beforeshow:this.onItemBeforeShow,iconchange:this.onItemIconChange,titlechange:this.onItemTitleChange});a.isPanel&&(this.removePanelHeader&&(a.preventHeader=!0,a.rendered&&a.updateHeader()),a.isPanel&&this.border&&a.setBorder(!1));this.rendered&&1===this.items.getCount()&&this.setActiveTab(0)}});
Ext.define("Cell.panel.gridTab",{extend:"Ext.panel.Panel",alias:"widget.cell.gridtab",cls:"tab-grid",bodyCls:"tab-grid-body",page:1,itemsInPage:20,checkbox:!1,sortableColumns:!0,gridPanel:null,pager:null,gridItems:{},storeFields:[],columns:[],initComponent:function(){var a=this;a.gridPanel=Ext.create("Cell.grid.GridPanel",{itemId:"grid-items",ui:"light",columns:a.columns,draggable:!1,selModel:a.checkbox?Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0}):Ext.create("Ext.selection.Model"),sortableColumns:a.sortableColumns,
store:{autoLoad:!0,fields:a.storeFields,proxy:{type:"memory",data:[]}}});a.checkbox&&(a.gridPanel.columns[0].draggable=!1);a.pager=Ext.create("Cell.panel.SimplePager",{onPrev:function(){a.page--;a.reload()},onNext:function(){a.page++;a.reload()},onSelect:function(b){a.page=b;a.reload()}});a.pager.getComponent("cell-pager-prev").setDisabled(!0);Ext.apply(a,{closable:!0,layout:"fit",listeners:{beforeRender:function(){a.onBeforeRender()},afterRender:function(){a.onAfterRender()}},bbar:a.pager,items:[a.gridPanel]});
a.callParent()},onBeforeRender:function(){this.gridPanel.on({resize:function(){if(this.headerCt.getEl()){var a=$(".x-box-inner",this.headerCt.getEl().dom).width();this.headerCt.getWidth()<a&&$(this.headerCt.getEl().dom).width("auto")}}})},onAfterRender:function(){Message.MainPanel.PopTabQueue.send()},removeColumn:function(a){var b=this.gridPanel.getStore(),c=a.dataIndex;b.removeField(c);b=0;a:for(;b<this.columns.length;b++)if(c===this.columns[b].dataIndex){this.columns.splice(b,1);break a}this.gridPanel.removeColumn(a)}});
Ext.define("Cell.panel.remoteGridTab",{extend:"Cell.panel.gridTab",alias:"widget.cell.remoteGrid",reloadParams:{},dataLoaded:!1,initComponent:function(){var a=this.sortableColumns;this.reloadParams={};this.reload();this.sortableColumns=!1;this.callParent();this.sortableColumns=a;this.gridPanel.headerCt.sortable=a},onBeforeRender:function(){var a=Ext.create("Cell.button.Button",{ui:"transparent",cls:"tab-grid-showproperty",icon:"/img/new_ide/cloud/btn_property_show.png",scope:this,tooltip:Forte.Resources.Text.GRIDTAB_ADDPROPERTY_TOOLTIP,
handler:this.openDisplayProperty});this.getDockedComponent("dockedtop").insert(2,a);this.gridPanel.on({columnmove:this.onColumnMove,columnresize:this.onColumnResize});this.callParent()},onAfterRender:function(){this.createHeaderMenu();this.callParent()},onColumnMove:function(a,b,c,d){a=this.ownerCt;b=a.columns[c-1];a.columns.splice(c-1,1);a.columns.splice(d-1,0,b);a.saveSettings()},onColumnResize:function(a,b,c){a=this.ownerCt;if(a.dataLoaded)for(var d=0;d<a.columns.length;d++)b.dataIndex===a.columns[d].dataIndex&&
(a.columns[d].width=c,a.saveSettings())},onListSuccess:function(a,b){var c=a.gridPanel,d=c.getStore();a.totalItems=b.totalItems;a.gridItems={};for(var e=0;e<b.items.length;e++){for(var g in b.items[e])"_createdAt"!==g&&("_updatedAt"!==g&&"_permission"!==g)&&(b.items[e][g]=Ext.htmlEncode(b.items[e][g]));a.gridItems[b.items[e]._id]=b.items[e]}0<d.getRange().length&&d.removeAll();d.add(b.items);a.pager.setPages(a.page,Math.ceil(a.totalItems/a.itemsInPage));c.reconfigure();a.dataLoaded=!0},openDisplayProperty:function(){var a=
this,b=[],c=[],d;for(d=0;d<a.columns.length;d++)"undefined"!==typeof a.columns[d].dataIndex&&c.push(a.columns[d].dataIndex);for(d=0;d<a.propertyNames.length;d++)inArray(a.propertyNames[d].key,c)||b.push({name:a.propertyNames[d].name,key:a.propertyNames[d].key});var c=Ext.create("Ext.data.Store",{fields:["name","key"],data:b}),e=Ext.create("Cell.window.LightWindow",{title:Forte.Resources.Text.CLOUD_DISPLAYPROPERTY_TITLE,closable:!0,resizable:!1,layout:"vbox",modal:!0,width:400,height:230,bbar:["->",
{xtype:"cell.button",ui:"light",width:100,text:Forte.Resources.Text.GENERAL_CANCEL,handler:function(){e.close()}},{xtype:"cell.button",itemId:"submit",ui:"blue",width:100,text:Forte.Resources.Text.GENERAL_ADD,handler:function(){var b=this,c=!1;b.setDisabled(!0);for(var d=e.getComponent("displayproperty").getValue(),i=d,j=0;j<a.propertyNames.length;j++)d===a.propertyNames[j].key&&(i=a.propertyNames[j].name);var k=a.getComponent("grid-items"),m=k.getStore(),l={header:Ext.htmlEncode(i),dataIndex:d,width:100};
a.reload({propertyNames:[d]},function(a,b){c=!0;for(var e=0;e<a.columns.length;e++)if(d===a.columns[e].dataIndex){a.onListSuccess(a,b);return}m.addField({name:d});a.columns.splice("actioncolumn"===a.columns[a.columns.length-1].xtype?a.columns.length-1:a.columns.length,0,l);k.addColumn(l);a.onListSuccess(a,b);a.saveSettings()},null,function(){b.setDisabled(!1);c&&e.close()})}}],items:[{xtype:"component",html:Forte.Resources.Text.CLOUD_DISPLAYPROPERTY_MSG,style:"margin:20px 0;"},{xtype:"cell.combo",
itemId:"displayproperty",displayField:"name",valueField:"key",store:c,value:b[0]?b[0].name:null,width:320,listeners:{afterrender:function(a){a.getEl().on("keypress",function(a){if(a.keyCode===Ext.EventObject.RETURN||10===a.keyCode)a=e.down("#submit"),a.handler.call(a)})}}}]}).show()},createHeaderMenu:function(){var a=this;a.gridPanel.headerCt.on("headertriggerclick",function(b,c,d,e){var d={text:Forte.Resources.Text.GRID_SORT_ASC,cls:"xg-hmenu-sort-asc",handler:a.onSortAscClick,scope:a},g={text:Forte.Resources.Text.GRID_SORT_DESC,
cls:"xg-hmenu-sort-desc",handler:a.onSortDescClick,scope:a},f=f||[{itemId:"hidecolumn",text:Forte.Resources.Text.CLOUD_HIDE_COLUMN,handler:function(b){a.removeColumn(b.ownerCt.activeHeader);a.reload(null,function(a,b){a.onListSuccess(a,b);a.saveSettings()})},scope:a}],f=b.sortable?[d,g,"-",f]:[f];b.menu||(b.menu=Ext.create("Ext.menu.Menu",{items:f,listeners:{deactivate:b.onMenuDeactivate,scope:b}}),b.setDisabledItems(),b.fireEvent("menucreate",b,b.menu));b.menu.activeHeader=b.menu.ownerCt=c;b.menu.setFloatParent(c);
c.titleContainer.addCls(b.headerOpenCls);(d=b.menu.down("#hidecolumn"))&&0===c.dataIndex.indexOf("_")?d.setDisabled(!0):d.setDisabled(!1);b.menu.showBy(e)})},onSortAscClick:function(a){this.reloadParams.sortProperty=a.ownerCt.activeHeader.dataIndex;this.reloadParams.sortOrder="asc";this.reload()},onSortDescClick:function(a){this.reloadParams.sortProperty=a.ownerCt.activeHeader.dataIndex;this.reloadParams.sortOrder="desc";this.reload()}});
Ext.define("Its.tab.plugin.Tool",{extend:"Ext.AbstractPlugin",alias:"plugin.itstabtool",init:function(a){var b=this.items;if(b){var c=a.getTabBar();c.flex=1;b=Ext.isArray(b)?b:[b];a.removeDocked(c,!1);a.addDocked({baseCls:Cell.prefix+"-tab-panel",itemCls:"cell-tab-panel-item",bodyCls:"cell-tab-panel-body",xtype:"toolbar",dock:c.dock||"top",items:"before"==this.position?b.concat(c):[c].concat(b)})}}});Ext.define("Cell.grid.GridPanel",{extend:"Ext.grid.GridPanel",alias:"widget.cell.grid",baseCls:Cell.prefix+"-grid-panel",bodyCls:"grid-panel-body",scroll:!1,addColumn:function(a){this.headerCt.add(a)},removeColumn:function(a){this.headerCt.remove(a);this.headerCt.headerCounter--},processEvent:function(a,b,c,d,e,g){var f;if(-1!==e&&(f=this.headerCt.getGridColumns()[e]))return f.processEvent.apply(f,arguments)},initComponent:function(){this.getSelectionModel().on("headerclick",function(a,b){b.isCheckerHd&&
(b.el.hasCls(Ext.baseCSSPrefix+"grid-hd-checker-on")?this.deselectAll(!0):this.selectAll(!0))});this.callParent()}});
Ext.define("Cell.panel.SimplePager",{extend:"Ext.panel.Panel",cls:"cell-pager cell-pager-simple",layout:{type:"hbox",align:"middle"},prevBtn:null,nextBtn:null,selectMenu:null,listeners:{afterrender:function(){this.prevBtn=this.getComponent("cell-pager-prev");this.nextBtn=this.getComponent("cell-pager-next");this.selectMenu=this.getComponent("cell-pager-select")}},initComponent:function(){Ext.apply(this,{items:[{xtype:"component",itemId:"cell-pager-text",html:"",flex:1,style:"text-align:right;"},{xtype:"cell.button",
itemId:"cell-pager-prev",cls:"cell-pager-prev",icon:"/img/new_ide/cloud/btn_previous.png",handler:this.onPrev,width:30,height:20},{xtype:"button",itemId:"cell-pager-select",cls:"cell-pager-select",text:"1",width:40,height:20,menu:Ext.create("Cell.menu.ContextMenu",{})},{xtype:"cell.button",itemId:"cell-pager-next",cls:"cell-pager-next",icon:"/img/new_ide/cloud/btn_next.png",handler:this.onNext,width:30,height:20}]});this.callParent()},setPages:function(a,b){var c=this,d=[];$(c.getComponent("cell-pager-text").getEl().dom).html(a+
" / "+b);for(var e=0;e<b;e++)d.push({text:e+1,handler:function(a){c.selectMenu.setText(a.text);c.onSelect(a.text)}});d=Ext.create("Cell.menu.ContextMenu",{items:d});Ext.apply(c.selectMenu,{menu:d});c.selectMenu.setText(a);1>=a?c.prevBtn.setDisabled(!0):c.prevBtn.setDisabled(!1);a>=b?c.nextBtn.setDisabled(!0):c.nextBtn.setDisabled(!1)},onPrev:function(){},onNext:function(){},onSelect:function(){}});
Ext.data.Store.override({addField:function(a){a instanceof Array||(a=[a]);this.getProxy().getModel().prototype.fields.add(a)},removeField:function(a){"number"===typeof a?this.getProxy().getModel().prototype.fields.removeAt(a):this.getProxy().getModel().prototype.fields.removeAtKey(a)}});Ext.define("Cell.tree.DarkTreePanel",{alias:"widget.cell.darktree",extend:"Ext.tree.Panel",baseCls:"cell-panel",ui:"dark",bodyCls:"panel-body",maxWidth:600});Ext.define("Cell.toolbar.TopToolbar",{extend:"Ext.toolbar.Toolbar",baseCls:"cell-top-toolbar"});Ext.define("Cell.toolbar.TopToolbarMark",{extend:"Ext.button.Button",alias:"widget.cell.monaca",width:142,height:35,cls:"cell-top-toolbar-monaca-mark",overCls:"cell-top-toolbar-monaca-mark-over"});Ext.define("Cell.toolbar.TopToolbarMenu",{extend:"Ext.menu.Menu",baseCls:"cell-top-toolbar-menu"});Ext.define("Cell.menu.ContextMenu",{extend:Cell.toolbar.TopToolbarMenu,ui:"context-menu"});
Ext.define("Cell.toolbar.TopToolbarButton",{extend:"Ext.button.Button",alias:"widget.cell.toolbarbutton",baseCls:"cell-top-toolbar-button"});Ext.define("Cell.toolbar.TopSplitButton",{extend:"Ext.button.Split",alias:"widget.cell.splitbutton",cls:"cell-top-split-button"});Ext.define("Cell.form.field.Base",{extend:"Ext.form.field.Base",alias:["widget.cell.field"],mixins:{helpMsg:"Cell.form.HelpMsg"},initComponent:function(){this.initHelpMsg();this.callParent()}});
Ext.define("Cell.form.field.Text",{extend:"Ext.form.field.Text",baseCls:"cell-form-field-text",alias:["widget.cell.textfield"],mixins:{helpMsg:"Cell.form.HelpMsg"},constructor:function(){Ext.form.field.Text.prototype.constructor.apply(this,arguments);"searchbox"==this.ui&&(this.width=129,this.setWidth(129))},initComponent:function(){this.initHelpMsg();this.callParent()},updateWrapperWidth:function(){Ext.select(".x-form-item-body",this.getEl()).setStyle({width:""})},listeners:{validitychange:function(){this.updateWrapperWidth()},
resize:function(){this.updateWrapperWidth()},afterrender:function(){this.updateWrapperWidth()}}});
Ext.define("Cell.form.field.SearchInputField",{extend:"Ext.form.field.Text",baseCls:"cell-form-field-searchinput",alias:"widget.cell.searchinput",loading:null,initComponent:function(){this.callParent()},afterRender:function(){this.loading=Ext.create("Ext.Component",{cls:"ide-loading-icon2",width:17,height:17,style:"position:absolute; top:5px; right:4px;",renderTo:this.getEl()}).hide();var a=$("input",this.getEl().dom)[0];$(a).on("mouseup",function(){a.select(0,a.value.length)})},showLoading:function(){this.loading.show()},
hideLoading:function(){this.loading.hide()}});Ext.define("Cell.form.field.Number",{extend:"Ext.form.field.Number",cls:"cell-form-field-number",alias:"widget.cell.numberfield"});Ext.define("Cell.form.field.TextArea",{extend:"Ext.form.field.TextArea",baseCls:"cell-form-field-textarea",alias:["widget.cell.textarea"],mixins:{helpMsg:"Cell.form.HelpMsg"},initComponent:function(){this.initHelpMsg();this.callParent()},updateWidth:function(){this.height&&this.getEl().select("textarea").setHeight(this.height-1)},listeners:{afterrender:function(){this.updateWidth()},resize:function(){this.updateWidth()}}});
Ext.define("Cell.form.field.AceField",{extend:"Ext.form.field.Base",alias:["widget.cell.acefield"],baseCls:"cell-acefield",style:"width:100%;",aceEditor:null,aceField:null,mode:null,theme:null,listeners:{afterrender:function(){this.onAfterRender()}},initComponent:function(){this.callParent()},onAfterRender:function(){this.createAceEditor()},createAceEditor:function(){this.setHeight(this.height?this.height:100);this.aceEditor=ace.edit(this.bodyEl.dom);this.theme&&this.aceEditor.setTheme("ace/theme/"+
this.theme);this.aceEditor.setHighlightActiveLine(this.highlightActiveLine?!0:!1);this.aceEditor.renderer.setShowGutter(this.gutter?!0:!1);var a=this.aceEditor.getSession();a.setValue(this.value);if(this.mode){var b=require("ace/mode/"+this.mode).Mode;a.setMode(new b)}},getValue:function(){return this.aceEditor.getSession().getValue()},setValue:function(a){this.aceEditor&&this.aceEditor.getSession().setValue(a)},copyAll:function(){var a=this.aceEditor.getValue(),a=$("<textarea />").val(a).appendTo(document.body).select();
document.execCommand("copy",!1,null)&&(new Message.Notify({message:Forte.Resources.Text.NOTIFY_COPY_TO_CLIPBOARD,type:"report"})).send();a.remove();this.aceEditor.selectAll();return!1}});Ext.define("Cell.fileDroppable",{text:Forte.Resources.Text.WIDGETS_UPLOAD_SPOT,dragoverText:Forte.Resources.Text.WIDGETS_UPLOAD_SPOTOVER,uploadPath:"/www/",uploadFilename:"",fileNum:{uploaded:0,total:0},uploadQueue:[],uploadQueueTimer:null,isUploading:!1,listeners:{afterrender:function(a){a.bindDropEvent(a)}},initFileDroppable:function(){this.update(this.text)},bindDropEvent:function(a){$(a.el.dom).on({dragenter:function(b){a.onDragenter(a,b)},dragover:a.absorbEvent,dragleave:function(b){a.onDragleave(a,
b)},drop:function(b){a.onDrop(a,b)}})},onDragenter:function(a,b){a.addClass("dragover");a.update(a.dragoverText);a.absorbEvent(b)},onDragleave:function(a,b){a.removeClass("dragover");a.update(a.text);a.absorbEvent(b)},onDrop:function(a,b){var c=b.originalEvent.dataTransfer.files,d=b.originalEvent.dataTransfer.items,e=[],g=[];a.disallowOverWrite=!0;a.fileNum.uploaded=0;a.fileNum.total=0;a.absorbEvent(b);a.removeClass("dragover");if(c.length){for(var f=0;f<c.length;f++)if(d){var h=d[f].webkitGetAsEntry();
h.isFile?e.push(a.pushItem(a.uploadPath+c[f].name,null,h)):h.isDirectory&&g.push(h)}else a.pushFile(a,c[f]);$.when.apply($,e).then(function(){g.forEach(function(b){a.parseDir(a,b)})})}},pushFile:function(a,b,c){a.uploadQueue.push({file:b,path:c});a.fileNum.total++;a.uploadQueueTimer||(a.uploadQueueTimer=setInterval(function(){if(!a.isUploading){var b=a.uploadQueue.shift();b&&a.uploadFile(a,b.file,b.path);a.uploadQueue.length||(clearInterval(a.uploadQueueTimer),a.uploadQueueTimer=null)}},70))},uploadFile:function(a,
b,c){c=c?c:a.uploadPath;"/"!==c.slice(-1)&&(c+="/");a.addCls("uploading");a.isUploading=!0;Forte.API.uploads(c,b,null,function(){a.isUploading=!1;a.onFileUploaded(a)},function(b,c){a.isUploading=!1;a.onUploadFail(a,b,c)})},parseDir:function(a,b){var c=b.createReader(),d=a.uploadPath;void 0!==a.selectedNode&&(d=a.selectedNode.data.filepath);c.readEntries(function(b){for(var c=[],f=[],h=0;h<b.length;h++)if(b[h].isFile){var i=d.substring(0,d.lastIndexOf("/"))+b[h].fullPath,j=i.substring(0,i.lastIndexOf("/")+
1);c.push(a.pushItem(i,j,b[h]))}else f.push(b[h]);$.when.apply($,c).then(function(){f.forEach(function(b){a.parseDir(a,b)})})})},pushItem:function(a,b,c){var d=new $.Deferred,e=this;c.file(function(c){Forte.API.treeCache[a]&&e.disallowOverWrite?window.confirm(Forte.Resources.Text.NOTIFY_UPLOAD_RESOURCES+"\n\n"+a)&&(e.pushFile(e,c,b),e.disallowOverWrite=!1):e.pushFile(e,c,b);d.resolve()});return d.promise()},onFileUploaded:function(a){a.fileNum.uploaded++;2<=a.fileNum.total&&(new Message.Notify({id:"uploading",
type:"none",message:Forte.Resources.Text.WIDGETS_UPLOAD_PROGRESS(a.fileNum.uploaded,a.fileNum.total)})).send();if(a.fileNum.uploaded>=a.fileNum.total)a.onUploadSuccess(a)},onUploadSuccess:function(a){a.removeCls("uploading");a.removeCls("dragover");a.update(a.text);(new Message.Notify({message:Forte.Resources.Text.NOTIFY_UPLOAD_FILE,type:"report"})).send();var b=Ext.getCmp("component:projectpanel");b.onCreateProjectTree(function(){a.uploadPath&&b.select(a.uploadPath+a.uploadFilename)})},onUploadFail:function(a,
b,c){a.removeCls("uploading");a.removeCls("dragover");a.update(a.text);Cell.LightMessageBox.alert(Forte.Resources.Text.ERROR_GENERAL_MONACA_TITLE,c);var d=a.uploadPath,e=Ext.getCmp("component:projectpanel");e.onCreateProjectTree(function(){d&&e.select(d)})},setUploadPath:function(a){this.uploadPath=a},absorbEvent:function(a){a.preventDefault();a.stopPropagation();return!1}});
Ext.define("Cell.DropArea",{extend:"Ext.Component",baseCls:"cell-droparea",alias:["widget.cell.droparea"],mixins:{fileDroppable:"Cell.fileDroppable"},initComponent:function(){this.initFileDroppable();this.callParent()},listeners:{afterrender:function(a){a.bindDropEvent(a)}}});Ext.define("Cell.form.field.ComboBox",{extend:"Ext.form.field.ComboBox",cls:"cell-combobox",mixins:{helpMsg:"Cell.form.HelpMsg"},alias:["widget.cell.combobox","widget.cell.combo"],queryMode:"local",createPicker:function(){var a=Ext.baseCSSPrefix+"menu",a=Ext.apply({selModel:{mode:this.multiSelect?"SIMPLE":"SINGLE"},floating:!0,hidden:!0,ownerCt:this.ownerCt,cls:this.el.up("."+a)?a:"",store:this.store,displayField:this.displayField,focusOnToFront:!1,pageSize:this.pageSize,getInnerTpl:function(a){return"{[fm.htmlEncode(values."+
a+")]}"}},this.listConfig,this.defaultListConfig),a=this.picker=Ext.create("Ext.view.BoundList",a);this.mon(a,{itemclick:this.onItemClick,refresh:this.onListRefresh,scope:this});this.mon(a.getSelectionModel(),{selectionChange:this.onListSelectionChange,scope:this});return a},initComponent:function(){this.initHelpMsg();this.callParent()}});
Ext.define("Cell.form.field.RemoteComboBox",{extend:"Cell.form.field.ComboBox",cls:"cell-combobox",alias:["widget.cell.remotecombobox","widget.cell.remotecombo"],minFetchLength:3,onKeyUp:function(){var a=this,b=this.getValue();b&&b.length>=a.minFetchLength?a.fetch(a,function(b){a.store.removeAll();a.store.add(b);a.expand()},b):a.collapse()},fetch:function(){}});Ext.define("Cell.form.field.Checkbox",{extend:"Ext.form.field.Checkbox",alias:["widget.cell.checkbox"],mixins:{helpMsg:"Cell.form.HelpMsg"},initComponent:function(){this.initHelpMsg();this.callParent()}});Ext.define("Cell.form.CheckboxGroup",{extend:"Ext.form.CheckboxGroup",alias:["widget.cell.checkboxgroup"],mixins:{helpMsg:"Cell.form.HelpMsg"},initComponent:function(){this.initHelpMsg();this.callParent()}});
