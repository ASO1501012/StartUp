window.ParentIDE=null!=window.opener?window.opener:window.parent,window.Consts={iframeUrlPrefix:window.previewUrl,frameSize:55,deviceList:{iphone6:{platform:"iOS",name:"iPhone 6",width:750,height:1334,viewportWidth:375},iphone5:{platform:"iOS",name:"iPhone 5",width:640,height:1136,viewportWidth:320},ipadpro:{platform:"iOS",name:"iPad Pro",width:2048,height:2732,viewportWidth:1024},ipad3:{platform:"iOS",name:"iPad Retina",width:1536,height:2048,viewportWidth:768},ipad2:{platform:"iOS",name:"iPad",width:768,height:1024,viewportWidth:768},nexus6p:{platform:"Android",name:"Nexus 6P",width:1440,height:2560,viewportWidth:480},nexus5x:{platform:"Android",name:"Nexus 5X",width:1080,height:1920,viewportWidth:360},nexus9:{platform:"Android",name:"Nexus 9",width:1536,height:2048,viewportWidth:512},nexus7_2013:{platform:"Android",name:"Nexus 7 [2013]",width:1200,height:1920,viewportWidth:601},nexus7:{platform:"Android",name:"Nexus 7 [2012]",width:800,height:1280,viewportWidth:603}},checkIcon:"ui-icon-check",isIde:ParentIDE.config&&ParentIDE.config.isIde||!1,isEditor:ParentIDE.config&&ParentIDE.config.isEditor||!1,projectId:window.projectId},window.i18n={textMap:{ja:{USE_DEBUGGER:'正確に表示するには、<a href="https://docs.monaca.io/ja/manual/debugger/" target="_blank">Monaca Debugger</a> を利用してください。',VERTICAL:"縦向き",HORIZONTAL:"横向き"},en:{USE_DEBUGGER:'To see the actual design, use <a href="https://docs.monaca.io/en/manual/debugger/" target="_blank">Monaca Debugger</a>.',VERTICAL:"Vertical",HORIZONTAL:"Horizontal"}},text:function(a){return i18n.textMap["ja"==LANG?"ja":"en"][a]},applyText:function(){$(".i18n-text").each(function(a,b){$element=$(b);var c=$element.data("i18n");$element.html(i18n.text(c))})}},window.Device={isVertical:!0,aspect:"iphone5",showMsgDebugger:!0,SETTING_ATTR_LIST:["isVertical","aspect","showMsgDebugger"],setDefaultAspect:function(){void 0===Consts.deviceList[this.aspect]&&(this.aspect="iphone5")},getRawWidth:function(){return this.setDefaultAspect(),Consts.deviceList[this.aspect].width},getRawHeight:function(){return this.setDefaultAspect(),Consts.deviceList[this.aspect].height},getRawViewportWidth:function(){return this.setDefaultAspect(),Consts.deviceList[this.aspect].viewportWidth},getRawViewportHeight:function(){return this.setDefaultAspect(),Math.round(this.getRawHeight()*(this.getRawViewportWidth()/this.getRawWidth()))},getViewportWidth:function(){return this.isVertical?this.getRawViewportWidth():this.getRawViewportHeight()},getViewportHeight:function(){return this.isVertical?this.getRawViewportHeight():this.getRawViewportWidth()},getWidth:function(){return this.isVertical?this.getRawWidth():this.getRawHeight()},getHeight:function(){return this.isVertical?this.getRawHeight():this.getRawWidth()},reload:function(){$E.iframe.attr("src",FileCombo.getUrl())},getStorageKey:function(){return Consts.projectId+"_prev"},saveSettings:function(){var a=this,b={};a.SETTING_ATTR_LIST.forEach(function(c){b[c]=a[c]}),localStorage.setItem(a.getStorageKey(),JSON.stringify(b))},getSettingParamsStr:function(){var a=this,b=localStorage.getItem(a.getStorageKey()),c="";return null!=b&&(b=JSON.parse(b),c="?"+a.getOrientationParamStr(b.isVertical)+a.getModelParamsStr(b.aspect)),c},getOrientationParamStr:function(a){return 1==a?"orientation=portrait":"orientation=landscape"},getModelParamsStr:function(a){var b="";for(var c in Consts.deviceList[a])b+="&"+c+"="+encodeURIComponent(Consts.deviceList[a][c]);return b},restoreSettings:function(){var a=this,b=localStorage.getItem(a.getStorageKey());null!=b&&(b=JSON.parse(b),a.SETTING_ATTR_LIST.forEach(function(c){void 0!==b[c]&&(a[c]=b[c])})),a.showMsgDebugger?$E.extraInfo.show():$E.extraInfo.hide()}},window.Layout={onResize:function(){var a=$E.window.innerWidth(),b=$E.window.innerHeight()-4,c=Math.max(150,a),d=Math.max(150,b),e=Device.getViewportWidth(),f=Device.getViewportHeight(),g=Math.min(c/e,d/f);c=Math.round(e*g),d=Math.round(f*g),$E.iframe.width(e),$E.iframe.height(f),$E.iframe.css("transform","scale("+g+")");var h=(a-c)/2;h=Math.max(0,Math.round(h)),$E.previewBox.css("left",h);var i=(b-d)/2;i=Math.max(0,Math.round(i)),$E.previewBox.css("top",i),$E.previewBox.width(c),$E.previewBox.height(d),window.setTimeout(function(){$E.extraInfo.width($E.window.innerWidth()-16)},100)}},window.FileCombo={items:{},updateOptions:function(){Device.reload()},getUrl:function(){return Consts.iframeUrlPrefix+"/www/index.html"+Device.getSettingParamsStr()}},window.Menu={init:function(){var a=this.getTag(),b=[{name:i18n.text("VERTICAL"),type:"orient",value:"v",isSelected:Device.isVertical},{name:i18n.text("HORIZONTAL"),type:"orient",value:"h",isSelected:!Device.isVertical},{name:"-"}];for(var c in Consts.deviceList){var d=Consts.deviceList[c],e=d.name+" ("+d.width+"x"+d.height+")";b.push({name:e,type:"aspect",value:c,isSelected:Device.aspect==c})}b.forEach(function(b){var c=$('<li><a href="#"><span class="ui-icon"></span><span class="name"></span></a></li>');"-"!=b.name?(c.find("span.name").text(b.name),b.isSelected===!0&&c.find("span.ui-icon").addClass(Consts.checkIcon),c.addClass(b.type),c.data("type",b.type),c.data("value",b.value)):c.empty(),a.append(c)}),a.on("mouseleave",function(){Menu.hide()}),a.on("click","li",function(b){var c=$(b.currentTarget),d=c.data("type"),e=c.data("value");switch(d){case"orient":Device.isVertical="v"==e,a.find(".orient .ui-icon").removeClass(Consts.checkIcon),c.find(".ui-icon").addClass(Consts.checkIcon);break;case"aspect":Device.aspect=e,a.find(".aspect .ui-icon").removeClass(Consts.checkIcon),c.find(".ui-icon").addClass(Consts.checkIcon)}return Menu.hide(),Layout.onResize(),Device.saveSettings(),Device.reload(),!1}),a.find("a").click(function(a){a.preventDefault()}),this.hide()},getTag:function(){return $("#ConfigMenu")},show:function(){this.getTag().show()},hide:function(){this.getTag().hide()},toggle:function(){this.getTag().toggle()}},$(function(){var a;window.Consts.isEditor?a=ParentIDE.angular.element(ParentIDE.document.querySelector("#previewer > div")).scope():window.Consts.isIde&&(a=ParentIDE.Ext.getCmp("component:previewpanel")),console.log(a),window.$E={window:$(window),nav:$("nav"),previewWrap:$("#PreviewWrap"),previewBox:$("#PreviewBox"),extraInfo:$("#ExtraInfo"),iframe:$("#PreviewBox iframe")},i18n.applyText(),Device.restoreSettings(),Layout.onResize(),Menu.init(),FileCombo.updateOptions(),$E.window.resize(function(){Layout.onResize()}),$E.extraInfo.find(".close-btn").click(function(){return $E.extraInfo.fadeOut(200),Device.showMsgDebugger=!1,Device.saveSettings(),!1}),$("#ReloadBtn").click(function(){return Device.reload(),!1}),$("#ConfigBtn").click(function(){return Menu.toggle(),!1}),$("#AttachBtn").click(function(){return a.onAttachBtn(),!1}),$("#DetachBtn").click(function(){return a.onDetachBtn(),!1}),window.Consts.isIde||window.Consts.isEditor||($("#AttachBtn").hide(),$("#DetachBtn").hide());var b=window;if(window.Consts.isIde)ParentIDE.MessageHub.subscribe(ParentIDE.Message.UpdateEditorState,function(a){try{switch(a.updatePreviewPanel()){case"show":!FileCombo.getTag().prop("disabled");break;case"update":b.setTimeout(function(){b.Device.reload()},600)}}catch(a){}});else if(window.Consts.isEditor){var c=a.fetchForSubscribe();c.PubSub.subscribe(c.Constant.EVENT.REFRESH_PREVIEWER,function(){b.setTimeout(function(){b.Device.reload()},600)})}});